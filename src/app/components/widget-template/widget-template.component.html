<div class="widget-container" 
     [style.background-color]="widget.color"
     [class.dragging]="isDragging"
     [class.resizing]="isResizing">
  
  <!-- ROW 1: TITLE/HEADER ROW (FIXED HEIGHT) -->
  <!-- Dev Note: This row has fixed height. Modify 'widget-header' height in CSS if needed -->
  <div class="widget-header">
    <div class="widget-title" 
         [attr.contenteditable]="isEditingTitle"
         [title]="isEditingTitle ? 'Press Enter to save, Esc to cancel' : 'Double-click to edit title'"
         (dblclick)="startEditTitle()"
         (blur)="finishEditTitle($event)"
         (keydown.enter)="finishEditTitle($event)"
         (keydown.escape)="cancelEditTitle($event)"
         (mousedown)="onTitleMouseDown($event)">
      {{ widget.title }}
    </div>

    <div class="header-controls">
      <!-- Drag Handle -->
      <div class="drag-handle" 
           title="Drag to move"
           data-drag-handle>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" data-icon="grip-vertical">
          <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
        </svg>
      </div>

      <div class="action-buttons">
        <button class="action-btn refresh-btn" 
                (click)="onRefresh($event)"
                (mousedown)="$event.stopPropagation()"
                title="Refresh">
          <!-- Icon: Arrow Clockwise/Refresh (Bootstrap Icons) -->
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" data-icon="arrow-clockwise">
            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
          </svg>
        </button>
        
        <button class="action-btn delete-btn" 
                (click)="onDelete($event)"
                (mousedown)="$event.stopPropagation()"
                title="Delete">
          Ã—
        </button>
      </div>
    </div>
  </div>

  <!-- ROW 2: CONTENT/FUNCTIONALITY ROW (FLEXIBLE HEIGHT, NON-SCROLLABLE) -->
  <!-- Dev Note: This row takes remaining space. NOT scrollable by default. -->
  <!-- Dev Note: To make scrollable, add 'overflow-y: auto' to 'widget-content-slot' in CSS -->
  <!-- Dev Note: Widget content is dynamically loaded based on widget.type -->
  <div class="widget-content-slot">
    <ng-template appWidgetContentHost></ng-template>
  </div>

  <div class="resize-handle" 
       (mousedown)="onResizeStart($event)"
       title="Resize">
    <!-- Icon: Resize Handle Triangle (Custom) -->
    <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" data-icon="resize-triangle">
      <path d="M12 0L0 12L12 12Z"/>
    </svg>
  </div>
</div>

