<!-- src/app/components/add-widget-dialog/add-widget-dialog.component.html -->

@if (show) {
  <div class="dialog-overlay" (click)="onOverlayClick()">
    <div class="dialog-content" (click)="onContentClick($event)">
      <div class="dialog-header">
        <h2>Add New Widget</h2>
        <div class="tab-navigation">
          <button 
            class="tab-button"
            [class.active]="activeTab === 'create'"
            (click)="switchTab('create')">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Create New
          </button>
          <button 
            class="tab-button"
            [class.active]="activeTab === 'preview'"
            (click)="switchTab('preview')">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3M21 5c0 1.66-4 3-9 3S3 6.66 3 5M21 19c0 1.66-4 3-9 3s-9-1.34-9-3M21 5v14M3 5v14"/>
            </svg>
            From Online
          </button>
        </div>
      </div>

      <!-- Create Tab Content -->
      @if (activeTab === 'create') {
        <div class="tab-content">
          <div class="form-group">
            <label>Widget Title</label>
        <input type="text" 
               class="form-input"
               [(ngModel)]="widgetTitle"
               placeholder="Enter widget title"
               (keydown)="onTitleKeydown($event)"
               autocomplete="off">
      </div>
      
      <div class="form-group">
        <label>Widget Type</label>
        <select class="form-input" 
                [(ngModel)]="selectedWidgetType">
          @for (widgetType of filteredWidgetTypes; track widgetType.type) {
            <option [value]="widgetType.type">
              {{ widgetType.label }} - {{ widgetType.description }}
            </option>
          }
        </select>
        
        <!-- Future: Widget type cards with icons and descriptions -->
        <!-- This will replace the simple dropdown above -->
      </div>
      
      <div class="form-group">
        <label>Color</label>
        <div class="color-grid">
          @for (color of availableColors; track color) {
            <button type="button"
                    class="color-option"
                    [class.selected]="selectedColor === color"
                    [style.background-color]="color"
                    (click)="selectedColor = color"
                    [title]="color">
            </button>
          }
        </div>
      </div>
      
          <div class="dialog-actions">
            <button class="btn btn-secondary" 
                    (click)="onCancel()"
                    title="Cancel">
              Cancel
            </button>
            <button class="btn btn-primary" 
                    (click)="onConfirm()"
                    title="Create Widget">
              Create Widget
            </button>
          </div>
        </div>
      }

      <!-- Preview Tab Content -->
      @if (activeTab === 'preview') {
        <div class="tab-content">
          <!-- Loading State -->
          @if (isLoadingOnlineWidgets) {
            <div class="loading-container">
              <div class="loading-spinner"></div>
              <p class="loading-text">Loading widgets from online service...</p>
            </div>
          }

          <!-- Error State -->
          @else if (onlineWidgetsError) {
            <div class="error-container">
              <div class="error-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
              </div>
              <h3 class="error-title">Failed to Load Online Widgets</h3>
              <p class="error-message">{{ onlineWidgetsError }}</p>
              <button class="btn btn-primary" (click)="retryLoadOnlineWidgets()">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                  <path d="M21 3v5h-5"/>
                  <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                  <path d="M3 21v-5h5"/>
                </svg>
                Retry
              </button>
            </div>
          }

          <!-- Widget Preview Grid -->
          @else if (onlineWidgets.length > 0) {
            <div class="widget-preview-section">
              <p class="preview-description">
                Select a widget from our online service to add to your dashboard:
              </p>
              
              <div class="widget-preview-grid">
                @for (widget of onlineWidgets; track widget.id) {
                  <div class="widget-preview-card"
                       [class.selected]="selectedOnlineWidget?.id === widget.id"
                       (click)="selectOnlineWidget(widget)">
                    <div class="widget-preview-header">
                      <div class="widget-preview-color" 
                           [style.background-color]="widget.color"></div>
                      <div class="widget-preview-info">
                        <h4 class="widget-preview-title">{{ widget.title }}</h4>
                        <span class="widget-preview-type">
                          {{ getWidgetTypeMetadata(widget.type)?.label || widget.type }}
                        </span>
                      </div>
                    </div>
                    <div class="widget-preview-content">
                      <div class="widget-size-indicator">
                        <span class="size-badge">{{ widget.gridSize.colSpan }}Ã—{{ widget.gridSize.rowSpan }}</span>
                      </div>
                      @if (selectedOnlineWidget?.id === widget.id) {
                        <div class="selection-indicator">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20,6 9,17 4,12"/>
                          </svg>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>

            <div class="dialog-actions">
              <button class="btn btn-secondary" 
                      (click)="onCancel()"
                      title="Cancel">
                Cancel
              </button>
              <button class="btn btn-primary" 
                      [disabled]="!selectedOnlineWidget"
                      (click)="addOnlineWidget()"
                      title="Add Selected Widget">
                Add Selected Widget
              </button>
            </div>
          }

          <!-- Empty State -->
          @else {
            <div class="empty-container">
              <div class="empty-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <line x1="9" y1="9" x2="15" y2="15"/>
                  <line x1="15" y1="9" x2="9" y2="15"/>
                </svg>
              </div>
              <h3 class="empty-title">No Widgets Available</h3>
              <p class="empty-message">No widgets are available from the online service right now.</p>
              <button class="btn btn-primary" (click)="retryLoadOnlineWidgets()">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                  <path d="M21 3v5h-5"/>
                  <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                  <path d="M3 21v-5h5"/>
                </svg>
                Try Again
              </button>
            </div>
          }
        </div>
      }
    </div>
  </div>
}

